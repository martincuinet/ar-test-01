<html>
  <head>
    <meta charset="utf-8" />
    <title>Myself At Home</title>
    <meta name="description" content="" />
     
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <!-- <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.4/dist/aframe-extras.min.js"></script> -->
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
      let isModelLoaded = false;

      // Function to extract animation names from the glTF model
    function getAnimationNames(model) {
      const animations = model.getObject3D('mesh').animations;
      return animations ? animations.map(anim => anim.name) : [];
    }

      // Component that launches when the marker is detected
      AFRAME.registerComponent('marker-detected', {
      init: function () {
        this.el.addEventListener('markerFound', () => {
          const messageDiv = document.getElementById('message');
          if (!isModelLoaded) {
            messageDiv.innerHTML = 'Marker detected, loading model...';
          } else {
            messageDiv.innerHTML = 'Tracking Marker...';
            setTimeout(() => {
              messageDiv.style.display = 'none';
            },3000); // Hide the message after 5 seconds
          }
          messageDiv.style.display = 'block';
        });

        this.el.addEventListener('markerLost', () => {
          const messageDiv = document.getElementById('message');
          messageDiv.innerHTML = 'Marker lost';
          messageDiv.style.display = 'block';
        });
      }
    });
  
      // Component that launches when the glTF model is loaded
      AFRAME.registerComponent('model-loaded-listener', {
      init: function () {
        this.el.addEventListener('model-loaded', () => {
          isModelLoaded = true;
          const messageDiv = document.getElementById('message');
          const button = document.getElementById('actionButton');
          const dropdown = document.getElementById('animationDropdown');
          
          messageDiv.innerHTML = 'Model loaded successfully!';
          setTimeout(() => {
            messageDiv.style.display = 'none';
          }, 5000); // Hide the message after 5 seconds
          
          button.style.display = 'block'; // Show the button
          dropdown.style.display = 'block'; // Show the dropdown

          // Populate the dropdown menu with animation names
          const animationNames = getAnimationNames(this.el);
          animationNames.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.innerHTML = name;
            dropdown.appendChild(option);
          });
        });
      }
    });
    </script>
  <style>
    #message {
      position: absolute;
      bottom: 200px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      display: none;
      z-index: 10; /* Ensure the message is above the scene */
    }
    #actionButton {
      position: absolute;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: #bf701c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: none;
      z-index: 20; /* Ensure the button is above other elements */
    }
    #actionButton:hover {
    background-color: #e28521;
  }
  #animationDropdown {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px;
      font-size: 16px;
      display: none;
      z-index: 20; /* Ensure the dropdown is above other elements */
    }
  </style> 
  </head>
  <body style="margin : 0px; overflow: hidden;">
    <div id="message">Waiting for marker...</div>
    <button id="actionButton" onclick="alert('Button Clicked!')">Take Action</button>
    <select id="animationDropdown"></select>
    <a-scene embedded arjs='sourceType: webcam; ' vr-mode-ui="enabled: false;">
           
      <a-marker type ="pattern" url = "./src/pattern-logo.patt" marker-detected>       
         <a-entity 
         position="0 0 0" 
         scale="1 1 1" 
         gltf-model= "./src/drunk.gltf" 
         animation-mixer 
         loop="true" 
         model-loaded-listener
         >
          </a-entity> 

         <a-plane 
         position="-0.02 0 0" 
         rotation="-90 0 0" 
         scale="1 1 1" 
         
         >
        </a-plane>
      </a-marker>
      <a-entity camera ></a-entity>            
    </a-scene>
  </body>
</html>